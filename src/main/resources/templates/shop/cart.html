<html lang="en" xmlns:th="http://www.thymeleaf.org" th:replace="base::layout(~{::section})">
<section>
    <style>
        .img-container {
            width: 150px;            /* StaÅ‚a szerokoÅ›Ä‡ kontenera */
            height: 150px;           /* StaÅ‚a wysokoÅ›Ä‡ kontenera */
            background-color: white; /* WypeÅ‚nienie tÅ‚a na biaÅ‚o */
            display: flex;           /* Centrowanie obrazka */
            align-items: center;     /* WyrÃ³wnanie obrazka w pionie */
            justify-content: center; /* WyrÃ³wnanie obrazka w poziomie */
            border-radius: 8px;      /* ZaokrÄ…glenie rogÃ³w (opcjonalne) */
            overflow: hidden;        /* Ukryj nadmiar obrazu */
        }

        .img-fit {
            width: 100%;            /* Dopasowanie szerokoÅ›ci obrazu do kontenera */
            height: 100%;           /* Dopasowanie wysokoÅ›ci obrazu do kontenera */
            object-fit: cover;      /* PrzyciÄ™cie obrazu przy zachowaniu wypeÅ‚nienia kontenera */
            object-position: center; /* Centrowanie obrazu w przypadku przyciÄ™cia */
        }



        .empty-cart-container {
            margin-top: 80px; /* WiÄ™kszy odstÄ™p od gÃ³ry */
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .empty-cart-notification {
            max-width: 900px; /* Maksymalna szerokoÅ›Ä‡ sekcji */
            padding: 40px; /* PowiÄ™kszenie marginesÃ³w wewnÄ™trznych */
            border-radius: 12px; /* ZaokrÄ…glone rogi sekcji */
            background-color: #f8f9fa; /* Jasne tÅ‚o dla lepszej widocznoÅ›ci */
            box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); /* Subtelny cieÅ„ */
        }

        .empty-cart-image {
            max-width: 300px; /* PowiÄ™kszenie obrazu */
            height: auto;
            margin-bottom: 30px; /* WiÄ™kszy odstÄ™p poniÅ¼ej obrazu */
        }
    </style>

    <body>

    <div th:if="${not #lists.isEmpty(cart.items)}" class="container mt-5">
        <div  class="col-lg-12">
            <div class="card mb-4">
                <div class="card-body">
                    <h1 class="text-center mb-4">TwÃ³j Koszyk</h1>
                </div>
            </div>
        </div>
        <div class="row">
            <!-- Tabela z produktami -->
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table align-middle">
                                <thead class="table-light">
                                <tr>
                                    <th hidden>ID</th>
                                    <th>ZdjÄ™cie</th>
                                    <th>Produkt</th>
                                    <th>Cena</th>
                                    <th>IloÅ›Ä‡</th>
                                    <th>Akcje</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="item : ${cart.items}">
                                    <td hidden th:text="${item.product.id}"></td>
                                    <td>
                                        <div class="img-container">
                                            <img class="img-fit"
                                                 alt="Product Image"
                                                 th:if="${item.product.image != null && !item.product.image.isEmpty()}"
                                                 th:src="'data:image/jpeg;base64,' + ${item.product.image}">

                                            <img class="img-fit"
                                                 alt="No Image Available"
                                                 th:if="${item.product.image == null || item.product.image.isEmpty()}"
                                                 src="https://demofree.sirv.com/nope-not-here.jpg">
                                        </div>
                                    </td>

                                    <td>
                                        <div >
                                            <p class="mb-1 fw-bold" th:text="${item.product.artist.name + ' - ' + item.product.title}">Nazwa produktu</p>
                                            <small class="mb-0 text-muted" th:text="${item.product.musicCategory.name + ', ' + item.product.mediaType.name()}">Yellow, Jeans</small>
                                        </div>
                                    </td>
                                    <td>
                                        <p class="mb-0 fw-bold" th:text="${item.product.price.multiply(T(java.math.BigDecimal).valueOf(item.quantity.longValue()))} + ' PLN'">1156 PLN</p>
                                        <small class="text-muted" th:text="${item.product.price} + ' PLN za sztukÄ™'">460 PLN za sztukÄ™</small>
                                    </td>
                                    <td>
                                        <form th:action="@{/cart/update/{id}(id=${item.product.id})}" method="post" style="display: flex; align-items: center;">
                                            <div class="input-group" style="width: 150px;">
                                                <!-- Zmniejsz iloÅ›Ä‡ -->
                                                <button
                                                        type="button"
                                                        class="btn btn-outline-secondary"
                                                        onclick="updateQuantity(this, -1)"
                                                        th:disabled="${item.quantity <= 1}">-</button>

                                                <!-- Pole iloÅ›ci -->
                                                <input
                                                        type="number"
                                                        name="quantity"
                                                        id="quantity"
                                                        th:value="${item.quantity}"
                                                        min="1"
                                                        th:max="${item.product.stockQuantity}"
                                                        class="form-control text-center quantity-input"
                                                        readonly />

                                                <!-- ZwiÄ™ksz iloÅ›Ä‡ -->
                                                <button
                                                        type="button"
                                                        class="btn btn-outline-secondary"
                                                        onclick="updateQuantity(this, 1)"
                                                        th:disabled="${item.quantity >= item.product.stockQuantity}">+</button>
                                            </div>
                                        </form>
                                    </td>
                                    <td>
                                        <form th:action="@{/cart/remove/{id}(id=${item.product.id})}" method="post">
                                            <button type="submit" class="btn btn-outline-danger btn-sm">UsuÅ„</button>
                                        </form>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>


                        <!-- Informacja o dostawie -->
                        <div class="mt-4 p-3 bg-light border">
                            <p class="mb-1"><strong>ðŸšš Darmowa dostawa w ciÄ…gu 1-2 tygodni</strong></p>
                            <p class="mb-0 text-muted">Wierzymy, Å¼e zakupy online powinny byÄ‡ tak proste, jak to tylko moÅ¼liwe. Dlatego oferujemy darmowÄ… dostawÄ™, abyÅ› mÃ³gÅ‚ skupiÄ‡ siÄ™ na tym, co najwaÅ¼niejsze â€“ cieszeniu siÄ™ swoimi nowymi produktami, bez ukrytych kosztÃ³w czy zbÄ™dnych opÅ‚at.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Podsumowanie zamÃ³wienia -->
            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="fw-bold">Podsumowanie</h5>
                        <ul class="list-unstyled mb-4">
                            <li class="d-flex justify-content-between">
                                <span>WartoÅ›Ä‡ produktÃ³w:</span>
                                <span th:text="${cart.totalPrice} + ' PLN'"></span>
                            </li>
                            <li class="d-flex justify-content-between">
                                <span>Dostawa:</span>
                                <span>Gratis</span>
                            </li>
                        </ul>
                        <h5 class="d-flex justify-content-between fw-bold">
                            <span>Razem z dostawÄ…:</span>
                            <span th:text="${cart.totalPrice} + ' PLN'"></span>
                        </h5>
                        <button class="btn btn-success w-100 mb-2">ZÅ‚Ã³Å¼ zamÃ³wienie</button>
                        <a class="btn btn-outline-secondary w-100" th:href="@{/shop}">WrÃ³Ä‡ do sklepu</a>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div th:if="${#lists.isEmpty(cart.items)}" class="empty-cart-container">
        <div class="empty-cart-notification">
            <div class="text-center">
                <img src="/img/empty-cart.png" alt="Empty Cart" class="empty-cart-image">
                <h3 class="fw-bold mt-4">TwÃ³j koszyk jest pusty</h3>
                <p class="text-muted fs-4 mt-2">
                    WyglÄ…da na to, Å¼e TwÃ³j koszyk jest pusty.<br />
                    Dodaj produkty, ktÃ³re CiÄ™ interesujÄ…, i rozpocznij zakupy!
                </p>
                <a class="btn btn-lg btn-primary mt-4 px-5 py-3" th:href="@{/shop}">PrzejdÅº do sklepu</a>
            </div>
        </div>
    </div>

    <script>
        function updateQuantity(button, change) {
            const form = button.closest('form');
            const input = form.querySelector('input[name="quantity"]');
            const maxQuantity = parseInt(input.getAttribute('max'));

            let newQuantity = parseInt(input.value) + change;

            if (newQuantity < 1) {
                newQuantity = 1;
            }

            if (maxQuantity && newQuantity > maxQuantity) {
                newQuantity = maxQuantity;
            }

            input.value = newQuantity;
            form.submit();
        }
    </script>
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    </body>
</section>
</html>

